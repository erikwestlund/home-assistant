- id: collect_hourly_data_office
  alias: "Collect Hourly Data for Office Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '0' # Office heat stores at 1; trigger at 2
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Office"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.tina_office_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.tina_office_average_temperature') | float(0)) - (states('input_number.hvac_office_average_temperature_60m_ago') | float(0)) }}"
        mini_split_setpoint: "{{ 'off' if (states('sensor.hvac_mini_split_setpoint_office') | float(0)) == 0 else states('sensor.hvac_mini_split_setpoint_office') | string }}"
        radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_office') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_office') | string }}"
        radiator_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_office') | float(0)) != (states('input_number.hvac_radiator_setpoint_office_60m_ago') | float(0)) else 0 }}"
        mini_split_setpoint_change: "{{ 1 if (states('sensor.hvac_mini_split_setpoint_office') | float(0)) != (states('input_number.hvac_mini_split_setpoint_office_60m_ago') | float(0)) else 0 }}"
        space_heater_power_status: "{{ 'off' if (states('binary_sensor.hvac_space_heater_active_office') == 'off') else 'on' }}"
        space_heater_power_status_change: "{{ 1 if (states('binary_sensor.hvac_space_heater_active_office') != states('input_boolean.space_heater_power_status_office_60m_ago')) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"


- id: collect_hourly_data_family_room
  alias: "Collect Hourly Data for Family Room Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '1'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Family Room"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.family_room_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.family_room_average_temperature') | float(0)) - (states('input_number.hvac_family_room_average_temperature_60m_ago') | float(0)) }}"
        radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_family_room') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_family_room') | string }}"
        mini_split_setpoint: "{{ 'off' if (states('sensor.hvac_mini_split_setpoint_family_room') | float(0)) == 0 else states('sensor.hvac_mini_split_setpoint_family_room') | string }}"
        radiator_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_family_room') | float(0)) != (states('input_number.hvac_radiator_setpoint_family_room_60m_ago') | float(0)) else 0 }}"
        mini_split_setpoint_change: "{{ 1 if (states('sensor.hvac_mini_split_setpoint_family_room') | float(0)) != (states('input_number.hvac_mini_split_setpoint_family_room_60m_ago') | float(0)) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"

- id: collect_hourly_data_living_room
  alias: "Collect Hourly Data for Living Room Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '2'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Living Room"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.living_room_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.living_room_average_temperature') | float(0)) - (states('input_number.hvac_living_room_average_temperature_60m_ago') | float(0)) }}"
        mini_split_setpoint: "{{ 'off' if (states('sensor.hvac_mini_split_setpoint_living_room') | float(0)) == 0 else states('sensor.hvac_mini_split_setpoint_living_room') | string }}"
        mini_split_setpoint_change: "{{ 1 if (states('sensor.hvac_mini_split_setpoint_living_room') | float(0)) != (states('input_number.hvac_mini_split_setpoint_living_room_60m_ago') | float(0)) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"

- id: collect_hourly_data_dining_room
  alias: "Collect Hourly Data for Dining Room Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '3'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Dining Room"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.dining_room_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.dining_room_average_temperature') | float(0)) - (states('input_number.hvac_dining_room_temperature_60m_ago') | float(0)) }}"
        mini_split_setpoint: "{{ 'off' if (states('sensor.hvac_mini_split_setpoint_dining_room') | float(0)) == 0 else states('sensor.hvac_mini_split_setpoint_dining_room') | string }}"
        mini_split_setpoint_change: "{{ 1 if (states('sensor.hvac_mini_split_setpoint_dining_room') | float(0)) != (states('input_number.hvac_mini_split_setpoint_dining_room_60m_ago') | float(0)) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"


- id: collect_hourly_data_erik_office
  alias: "Collect Hourly Data for Erik Office Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '4'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Erik Office"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.erik_office_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.erik_office_average_temperature') | float(0)) - (states('input_number.hvac_erik_office_temperature_60m_ago') | float(0)) }}"
        mini_split_setpoint: "{{ states('sensor.hvac_mini_split_setpoint_erik_office') | float(0) }}"
        mini_split_setpoint_change: "{{ 1 if (states('sensor.hvac_mini_split_setpoint_erik_office') | float(0)) != (states('input_number.hvac_mini_split_setpoint_erik_office_60m_ago') | float(0)) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"

- id: collect_hourly_data_master_bedroom
  alias: "Collect Hourly Data for Master Bedroom Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '5'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Master Bedroom"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.master_bedroom_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.master_bedroom_average_temperature') | float(0)) - (states('input_number.hvac_master_bedroom_average_temperature_60m_ago') | float(0)) }}"
        mini_split_setpoint: "{{ 'off' if (states('sensor.hvac_mini_split_setpoint_master_bedroom') | float(0)) == 0 else states('sensor.hvac_mini_split_setpoint_master_bedroom') | string }}"
        mini_split_setpoint_change: "{{ 1 if (states('sensor.hvac_mini_split_setpoint_master_bedroom') | float(0)) != (states('input_number.hvac_mini_split_setpoint_master_bedroom_60m_ago') | float(0)) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"

- id: collect_hourly_data_ducted
  alias: "Collect Hourly Data for Ducted Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '6'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Ducted"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('input_number.outdoor_temperature_60m_ago') | float(0) }}"
        outdoor_temp_current: "{{ states('sensor.current_temperature') | float(0) }}"
        outdoor_hour_temp_change: "{{ (states('sensor.current_temperature') | float(0)) - (states('input_number.outdoor_temperature_60m_ago') | float(0)) }}"
        temp_now: "{{ states('sensor.kids_rooms_average_temperature') | float(0) }}"
        hour_temp_change: "{{ (states('sensor.kids_rooms_average_temperature') | float(0)) - (states('input_number.hvac_kids_rooms_average_temperature_60m_ago') | float(0)) }}"
        hank_room_temp_now: "{{ states('sensor.hank_s_room_average_temperature') | float(0) }}"
        hank_room_hour_temp_change: "{{ (states('sensor.hank_s_room_average_temperature') | float(0)) - (states('input_number.hvac_hank_room_temperature_60m_ago') | float(0)) }}"
        tilly_room_temp_now: "{{ states('sensor.tilly_s_room_average_temperature') | float(0) }}"
        tilly_room_hour_temp_change: "{{ (states('sensor.tilly_s_room_average_temperature') | float(0)) - (states('input_number.hvac_tilly_room_temperature_60m_ago') | float(0)) }}"
        ducted_setpoint: "{{ 'off' if (states('sensor.hvac_ducted_setpoint') | float(0)) == 0 else states('sensor.hvac_ducted_setpoint') | string }}"
        ducted_setpoint_change: "{{ 1 if (states('sensor.hvac_setpoint_ducted') | float(0)) != (states('input_number.hvac_setpoint_ducted_60m_ago') | float(0)) else 0 }}"
        main_zone_radiator_setpoint: "{{ 'off' if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) == 0 else states('sensor.hvac_radiator_setpoint_main_zone') | string }}"
        main_zone_setpoint_change: "{{ 1 if (states('sensor.hvac_radiator_setpoint_main_zone') | float(0)) != (states('input_number.hvac_radiator_setpoint_main_zone_60m_ago') | float(0)) else 0 }}"
