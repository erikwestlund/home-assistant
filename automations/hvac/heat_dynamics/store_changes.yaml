- id: collect_hourly_data_office
  alias: "Collect Hourly Data for Office Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '1' # Office heat stores at 1; trigger at 2
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Office"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_office_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_office_temp_change_hour') }}"
        mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_office_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_office_mini_split_prev_hour') }}"
        mini_split_changed: "{{ 1 if is_state('sensor.snapshot_office_mini_split_changed', 'unknown') or is_state('sensor.snapshot_office_mini_split_changed', '0') else  0 }}"
        radiator_prev_hour: "{{ 'off' if is_state('sensor.snapshot_office_radiator_prev_hour', 'unavailable') else states('sensor.snapshot_office_radiator_prev_hour') }}"
        radiator_changed: "{{ 1 if is_state('sensor.snapshot_office_radiator_changed', 'unknown') or is_state('sensor.snapshot_office_radiator_changed', '0') else  0 }}"
        space_heater_power_status_office_prev_hour: "{{ states('sensor.snapshot_space_heater_power_status_office_prev_hour') }}"
        space_heater_power_status_office_changed: "{{ states('sensor.snapshot_space_heater_power_status_office_changed') }}"
        exterior_door_closed_prev_hour: "{{ states('sensor.snapshot_office_exterior_door_closed_prev_hour', 'on') }}"
        erik_office_temp_prev_hour: "{{ states('sensor.snapshot_erik_office_temp_prev_hour') }}"
        kitchen_temp_prev_hour: "{{ states('sensor.snapshot_kitchen_temp_prev_hour') }}"
        office_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_office_radiators_calling_for_heat_prev_hour') }}"
        office_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_office_radiators_calling_for_heat_changed', 'on') else 0 }}"
        erik_office_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_erik_office_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_erik_office_mini_split_prev_hour') }}"
        dining_room_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_dining_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_dining_room_mini_split_prev_hour') }}"
        space_heater_energy_hourly: "{{ states('sensor.snapshot_space_heater_energy_hourly') }}"
        heat_pump_offices_dining_room_energy_hourly: "{{ states('sensor.snapshot_heat_pump_offices_dining_room_energy_hourly') }}"

- id: collect_hourly_data_family_room
  alias: "Collect Hourly Data for Family Room Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '2'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Family Room"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_family_room_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_family_room_temp_change_hour') }}"
        mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_family_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_family_room_mini_split_prev_hour') }}"
        mini_split_changed: "{{ 1 if is_state('sensor.snapshot_family_room_mini_split_changed', 'unknown') or is_state('sensor.snapshot_family_room_mini_split_changed', '0') else  0 }}"
        radiator_prev_hour: "{{ 'off' if is_state('sensor.snapshot_family_room_radiator_prev_hour', 'unavailable') else states('sensor.snapshot_family_room_radiator_prev_hour') }}"
        radiator_changed: "{{ 1 if is_state('sensor.snapshot_family_room_radiator_changed', 'unknown') or is_state('sensor.snapshot_family_room_radiator_changed', '0') else  0 }}"
        interior_door_closed_prev_hour: "{{ states('sensor.snapshot_family_room_interior_door_closed_prev_hour', 'on') }}"
        kitchen_temp_prev_hour: "{{ states('sensor.snapshot_kitchen_temp_prev_hour') }}"
        living_room_temp_prev_hour: "{{ states('sensor.snapshot_living_room_temp_prev_hour') }}"
        basement_playroom_temp_prev_hour: "{{ states('sensor.snapshot_basement_playroom_temp_prev_hour') }}"
        main_zone_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour') }}"
        main_zone_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        family_room_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_family_room_radiators_calling_for_heat_prev_hour') }}"
        family_room_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_family_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        ducted_prev_hour: "{{ 'off' if is_state('sensor.snapshot_ducted_prev_hour', 'unavailable') else states('sensor.snapshot_ducted_prev_hour') }}"
        heat_pump_family_room_ducted_energy_hourly: "{{ states('sensor.snapshot_heat_pump_family_room_ducted_energy_hourly') }}"

- id: collect_hourly_data_living_room
  alias: "Collect Hourly Data for Living Room Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '3'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Living Room"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_living_room_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_living_room_temp_change_hour') }}"
        mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_living_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_living_room_mini_split_prev_hour') }}"
        mini_split_changed: "{{ 1 if is_state('sensor.snapshot_living_room_mini_split_changed', 'unknown') or is_state('sensor.snapshot_living_room_mini_split_changed', '0') else  0 }}"
        radiator_prev_hour: "{{ 'off' if is_state('sensor.snapshot_main_zone_radiator_prev_hour', 'unavailable') else states('sensor.snapshot_main_zone_radiator_prev_hour') }}"
        radiator_changed: "{{ 1 if is_state('sensor.snapshot_main_zone_radiator_changed', 'unavailable') or is_state('sensor.snapshot_main_zone_radiator_changed', '0') else  0 }}"
        dining_room_temp_prev_hour: "{{ states('sensor.snapshot_dining_room_temp_prev_hour') }}"
        family_room_temp_prev_hour: "{{ states('sensor.snapshot_family_room_temp_prev_hour') }}"
        main_zone_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour') }}"
        main_zone_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        master_bedroom_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_master_bedroom_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_master_bedroom_mini_split_prev_hour') }}"
        heat_pump_living_room_master_bedroom_energy_hourly: "{{ states('sensor.snapshot_heat_pump_living_room_master_bedroom_energy_hourly') }}"

- id: collect_hourly_data_dining_room
  alias: "Collect Hourly Data for Dining Room Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '4'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Dining Room"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_dining_room_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_dining_room_temp_change_hour') }}"
        mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_dining_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_dining_room_mini_split_prev_hour') }}"
        mini_split_changed: "{{ 1 if is_state('sensor.snapshot_dining_room_mini_split_changed', 'unknown') or is_state('sensor.snapshot_dining_room_mini_split_changed', '0') else  0 }}"
        kitchen_temp_prev_hour: "{{ states('sensor.snapshot_kitchen_temp_prev_hour') }}"
        living_room_temp_prev_hour: "{{ states('sensor.snapshot_living_room_temp_prev_hour') }}"
        basement_playroom_temp_prev_hour: "{{ states('sensor.snapshot_basement_playroom_temp_prev_hour') }}"
        family_room_temp_prev_hour: "{{ states('sensor.snapshot_family_room_temp_prev_hour') }}"
        main_zone_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour') }}"
        main_zone_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        office_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_office_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_office_mini_split_prev_hour') }}"
        erik_office_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_erik_office_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_erik_office_mini_split_prev_hour') }}"
        heat_pump_offices_dining_room_energy_hourly: "{{ states('sensor.snapshot_heat_pump_offices_dining_room_energy_hourly') }}"


- id: collect_hourly_data_erik_office
  alias: "Collect Hourly Data for Erik Office Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '5'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Erik Office"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_erik_office_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_erik_office_temp_change_hour') }}"
        mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_erik_office_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_erik_office_mini_split_prev_hour') }}"
        mini_split_changed: "{{ 1 if is_state('sensor.snapshot_erik_office_mini_split_changed', 'unknown') or is_state('sensor.snapshot_erik_office_mini_split_changed', '0') else  0 }}"
        office_temp_prev_hour: "{{ states('sensor.snapshot_office_temp_prev_hour') }}"
        hanks_room_temp_prev_hour: "{{ states('sensor.snapshot_hank_s_room_temp_prev_hour') }}"
        main_zone_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour') }}"
        main_zone_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        office_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_office_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_office_mini_split_prev_hour') }}"
        dining_room_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_dining_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_dining_room_mini_split_prev_hour') }}"
        heat_pump_offices_dining_room_energy_hourly: "{{ states('sensor.snapshot_heat_pump_offices_dining_room_energy_hourly') }}"

- id: collect_hourly_data_master_bedroom
  alias: "Collect Hourly Data for Master Bedroom Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '6'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Master Bedroom"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_master_bedroom_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_master_bedroom_temp_change_hour') }}"
        mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_master_bedroom_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_master_bedroom_mini_split_prev_hour') }}"
        mini_split_changed: "{{ 1 if is_state('sensor.snapshot_master_bedroom_mini_split_changed', 'unknown') or is_state('sensor.snapshot_master_bedroom_mini_split_changed', '0') else  0 }}"
        radiator_prev_hour: "{{ 'off' if is_state('sensor.snapshot_main_zone_radiator_prev_hour', 'unavailable') else states('sensor.snapshot_main_zone_radiator_prev_hour') }}"
        radiator_changed: "{{ 1 if is_state('sensor.snapshot_main_zone_radiator_changed', 'unavailable') or is_state('sensor.snapshot_main_zone_radiator_changed', '0') else  0 }}"
        door_closed_prev_hour: "{{ states('sensor.snapshot_master_bedroom_door_closed_prev_hour', 'on') }}"
        main_zone_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour') }}"
        main_zone_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        living_room_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_living_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_living_room_mini_split_prev_hour') }}"
        heat_pump_living_room_master_bedroom_energy_hourly: "{{ states('sensor.snapshot_heat_pump_living_room_master_bedroom_energy_hourly') }}"

- id: collect_hourly_data_ducted
  alias: "Collect Hourly Data for Ducted Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '7'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Ducted"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        temp_now: "{{ states('sensor.snapshot_kids_rooms_temp_now') }}"
        temp_change_hour: "{{ states('sensor.snapshot_kids_rooms_temp_change_hour') }}"
        hanks_room_temp_prev_hour: "{{ states('sensor.snapshot_hank_s_room_temp_prev_hour') }}"
        hanks_room_temp_change_hour: "{{ states('sensor.snapshot_hank_s_room_temp_change_hour') }}"
        tillys_room_temp_prev_hour: "{{ states('sensor.snapshot_tilly_s_room_temp_prev_hour') }}"
        tillys_room_temp_change_hour: "{{ states('sensor.snapshot_tilly_s_room_temp_change_hour') }}"
        ducted_prev_hour: "{{ 'off' if is_state('sensor.snapshot_ducted_prev_hour', 'unavailable') else states('sensor.snapshot_ducted_prev_hour') }}"
        ducted_changed: "{{ 1 if is_state('sensor.snapshot_ducted_changed', 'unknown') or is_state('sensor.snapshot_ducted_changed', '0') else  0 }}"
        tilly_door_closed_prev_hour: "{{ states('sensor.snapshot_tilly_door_closed_prev_hour', 'on') }}"
        hank_main_door_closed_prev_hour: "{{ states('sensor.snapshot_hank_main_door_closed_prev_hour', 'on') }}"
        hank_side_door_closed_prev_hour: "{{ states('sensor.snapshot_hank_side_door_closed_prev_hour', 'on') }}"
        main_zone_radiators_calling_for_heat_prev_hour: "{{ states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour') }}"
        main_zone_radiators_calling_for_heat_changed: "{{ 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0 }}"
        family_room_mini_split_prev_hour: "{{ 'off' if is_state('sensor.snapshot_family_room_mini_split_prev_hour', 'unavailable') else states('sensor.snapshot_family_room_mini_split_prev_hour') }}"
        heat_pump_family_room_ducted_energy_hourly: "{{ states('sensor.snapshot_heat_pump_family_room_ducted_energy_hourly') }}"

- id: collect_hourly_data_ducted
  alias: "Collect Hourly Data for Ducted Heat Dynamics"
  trigger:
    platform: time_pattern
    minutes: '8'
  action:
    service: google_sheets.append_sheet
    data:
      config_entry: !secret google_sheets_sheet_id
      worksheet: "Energy Usage"
      data:
        timestamp: "{{ now().strftime('%Y-%m-%d %H:%M:%S') }}"
        outdoor_temp_hour_ago: "{{ states('sensor.snapshot_outdoor_temp_hour_ago') }}"
        outdoor_temp_current: "{{ states('sensor.snapshot_outdoor_temp_current') }}"
        outdoor_hour_temp_change: "{{ states('sensor.snapshot_outdoor_hour_temp_change') }}"
        space_heater_energy_hourly: "{{ states('sensor.snapshot_space_heater_energy_hourly') }}"
        heat_pump_offices_dining_room_energy_hourly: "{{ states('sensor.snapshot_heat_pump_offices_dining_room_energy_hourly') }}"
        heat_pump_living_room_master_bedroom_energy_hourly: "{{ states('sensor.snapshot_heat_pump_living_room_master_bedroom_energy_hourly') }}"
        heat_pump_family_room_ducted_energy_hourly: "{{ states('sensor.snapshot_heat_pump_family_room_ducted_energy_hourly') }}"
        heat_pump_all_energy_hourly: "{{ states('sensor.snapshot_all_heat_pumps_energy_hourly') }}"
        whole_home_energy_hourly: "{{ states('sensor.snapshot_whole_house_energy_hourly') }}"
