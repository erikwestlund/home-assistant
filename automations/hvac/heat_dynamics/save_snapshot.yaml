- id: "store_snapshot_hourly_data"
  alias: "Store Snapshot Hourly Data"
  trigger:
    - platform: time_pattern
      minutes: '0'
  action:
    - service: input_text.set_value
      target:
        entity_id: input_text.snapshot_hourly_data
      data:
        value: >
          {{
              {
                 "timestamp": now().strftime('%Y-%m-%d %H:%M:%S'),
                 "outdoor_temp_hour_ago": states('sensor.snapshot_outdoor_temp_hour_ago'),
                 "outdoor_temp_current": states('sensor.snapshot_outdoor_temp_current'),
                 "outdoor_hour_temp_change": states('sensor.snapshot_outdoor_hour_temp_change'),
                 "heat_pump_living_room_master_bedroom_energy_hourly": states('sensor.snapshot_heat_pump_living_room_master_bedroom_energy_hourly'),
                 "heat_pump_family_room_ducted_energy_hourly": states('sensor.snapshot_heat_pump_family_room_ducted_energy_hourly'),
                 "heat_pump_offices_dining_room_energy_hourly": states('sensor.snapshot_heat_pump_offices_dining_room_energy_hourly'),
                 "all_heat_pumps_energy_hourly": states('sensor.snapshot_all_heat_pumps_energy_hourly'),
                 "whole_house_energy_hourly": states('sensor.snapshot_whole_house_energy_hourly'),
                 "office_radiators_calling_for_heat_prev_hour": states('sensor.snapshot_office_radiators_calling_for_heat_prev_hour'),
                 "office_radiators_calling_for_heat_now": states('sensor.snapshot_office_radiators_calling_for_heat_now'),
                 "office_radiators_calling_for_heat_changed": 1 if is_state('sensor.snapshot_office_radiators_calling_for_heat_changed', 'on') else 0,
                 "family_room_radiators_calling_for_heat_prev_hour": states('sensor.snapshot_family_room_radiators_calling_for_heat_prev_hour'),
                 "family_room_radiators_calling_for_heat_now": states('sensor.snapshot_family_room_radiators_calling_for_heat_now'),
                 "family_room_radiators_calling_for_heat_changed": 1 if is_state('sensor.snapshot_family_room_radiators_calling_for_heat_changed', 'on') else 0,
                 "living_room_radiators_calling_for_heat_prev_hour": states('sensor.snapshot_living_room_radiators_calling_for_heat_prev_hour'),
                 "living_room_radiators_calling_for_heat_now": states('sensor.snapshot_living_room_radiators_calling_for_heat_now'),
                 "living_room_radiators_calling_for_heat_changed": 1 if is_state('sensor.snapshot_living_room_radiators_calling_for_heat_changed', 'on') else 0,
                 "office_temp_now": states('sensor.snapshot_office_temp_now'),
                 "office_temp_prev_hour": states('sensor.snapshot_office_temp_prev_hour'),
                 "office_temp_change_hour": states('sensor.snapshot_office_temp_change_hour'),
                 "family_room_temp_now": states('sensor.snapshot_family_room_temp_now'),
                 "family_room_temp_prev_hour": states('sensor.snapshot_family_room_temp_prev_hour'),
                 "family_room_temp_change_hour": states('sensor.snapshot_family_room_temp_change_hour'),
                 "living_room_temp_now": states('sensor.snapshot_living_room_temp_now'),
                 "living_room_temp_prev_hour": states('sensor.snapshot_living_room_temp_prev_hour'),
                 "living_room_temp_change_hour": states('sensor.snapshot_living_room_temp_change_hour'),
                 "dining_room_temp_now": states('sensor.snapshot_dining_room_temp_now'),
                 "dining_room_temp_prev_hour": states('sensor.snapshot_dining_room_temp_prev_hour'),
                 "dining_room_temp_change_hour": states('sensor.snapshot_dining_room_temp_change_hour'),
                 "kitchen_temp_now": states('sensor.snapshot_kitchen_temp_now'),
                 "kitchen_temp_prev_hour": states('sensor.snapshot_kitchen_temp_prev_hour'),
                 "kitchen_temp_change_hour": states('sensor.snapshot_kitchen_temp_change_hour'),
                 "kids_rooms_temp_now": states('sensor.snapshot_kids_rooms_temp_now'),
                 "kids_rooms_temp_prev_hour": states('sensor.snapshot_kids_rooms_temp_prev_hour'),
                 "kids_rooms_temp_change_hour": states('sensor.snapshot_kids_rooms_temp_change_hour'),
                 "hanks_room_temp_now": states('sensor.snapshot_hank_s_room_temp_now'),
                 "hanks_room_temp_prev_hour": states('sensor.snapshot_hank_s_room_temp_prev_hour'),
                 "hanks_room_temp_change_hour": states('sensor.snapshot_hank_s_room_temp_change_houra'),
                 "tillys_room_temp_now": states('sensor.snapshot_tilly_s_room_temp_now'),
                 "tillys_room_temp_prev_hour": states('sensor.snapshot_tilly_s_room_temp_prev_hour'),
                 "tillys_room_temp_change_hour": states('sensor.snapshot_tilly_s_room_temp_change_hour'),
                 "master_bedroom_temp_now": states('sensor.snapshot_master_bedroom_temp_now'),
                 "master_bedroom_temp_prev_hour": states('sensor.snapshot_master_bedroom_temp_prev_hour'),
                 "master_bedroom_temp_change_hour": states('sensor.snapshot_master_bedroom_temp_change_hour'),
                 "office_radiator_prev_hour": 'off' if states('sensor.snapshot_office_radiator_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_office_radiator_prev_hour'),
                 "office_radiator_now": 'off' if states('sensor.snapshot_office_radiator_now') in ['unknown', '0'] else states('sensor.snapshot_office_radiator_now'),
                 "office_radiator_changed": 1 if is_state('sensor.snapshot_office_radiator_changed', 'unknown') or is_state('sensor.snapshot_office_radiator_changed', '0') else  0,
                 "family_room_radiator_prev_hour": 'off' if states('sensor.snapshot_family_room_radiator_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_family_room_radiator_prev_hour'),
                 "family_room_radiator_now": 'off' if states('sensor.snapshot_family_room_radiator_now') in ['unknown', '0'] else states('sensor.snapshot_family_room_radiator_now'),
                 "family_room_radiator_changed": 1 if is_state('sensor.snapshot_family_room_radiator_changed', 'unknown') or is_state('sensor.snapshot_family_room_radiator_changed', '0') else  0,
                 "main_zone_radiator_prev_hour": 'off' if states('sensor.snapshot_main_zone_radiator_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_main_zone_radiator_prev_hour'),
                 "main_zone_radiator_now": 'off' if states('sensor.snapshot_main_zone_radiator_now') in ['unknown', '0'] else states('sensor.snapshot_main_zone_radiator_now'),
                 "main_zone_radiator_changed": 1 if is_state('sensor.snapshot_main_zone_radiator_changed', 'unknown') or is_state('sensor.snapshot_main_zone_radiator_changed', '0') else  0,
                 "office_mini_split_prev_hour": 'off' if states('sensor.snapshot_office_mini_split_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_office_mini_split_prev_hour'),
                 "office_mini_split_now": 'off' if states('sensor.snapshot_office_mini_split_now') in ['unknown', '0'] else states('sensor.snapshot_office_mini_split_now'),
                 "office_mini_split_changed": 1 if is_state('sensor.snapshot_office_mini_split_changed', 'unknown') or is_state('sensor.snapshot_office_mini_split_changed', '0') else  0,
                 "family_room_mini_split_prev_hour": 'off' if states('sensor.snapshot_family_room_mini_split_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_family_room_mini_split_prev_hour'),
                 "family_room_mini_split_now": 'off' if states('sensor.snapshot_family_room_mini_split_now') in ['unknown', '0'] else states('sensor.snapshot_family_room_mini_split_now'),
                 "family_room_mini_split_changed": 1 if is_state('sensor.snapshot_family_room_mini_split_changed', 'unknown') or is_state('sensor.snapshot_family_room_mini_split_changed', '0') else  0,
                 "living_room_mini_split_prev_hour": 'off' if states('sensor.snapshot_living_room_mini_split_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_living_room_mini_split_prev_hour'),
                 "living_room_mini_split_now": 'off' if states('sensor.snapshot_living_room_mini_split_now') in ['unknown', '0'] else states('sensor.snapshot_living_room_mini_split_now'),
                 "living_room_mini_split_changed": 1 if is_state('sensor.snapshot_living_room_mini_split_changed', 'unknown') or is_state('sensor.snapshot_living_room_mini_split_changed', '0') else  0,
                 "dining_room_mini_split_prev_hour": 'off' if states('sensor.snapshot_dining_room_mini_split_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_dining_room_mini_split_prev_hour'),
                 "dining_room_mini_split_now": 'off' if states('sensor.snapshot_dining_room_mini_split_now') in ['unknown', '0'] else states('sensor.snapshot_dining_room_mini_split_now'),
                 "dining_room_mini_split_changed": 1 if is_state('sensor.snapshot_dining_room_mini_split_changed', 'unknown') or is_state('sensor.snapshot_dining_room_mini_split_changed', '0') else  0,
                 "erik_office_mini_split_prev_hour": 'off' if states('sensor.snapshot_erik_office_mini_split_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_erik_office_mini_split_prev_hour'),
                 "erik_office_mini_split_now": 'off' if states('sensor.snapshot_erik_office_mini_split_now') in ['unknown', '0'] else states('sensor.snapshot_erik_office_mini_split_now'),
                 "erik_office_mini_split_changed": 1 if is_state('sensor.snapshot_erik_office_mini_split_changed', 'unknown') or is_state('sensor.snapshot_erik_office_mini_split_changed', '0') else  0,
                 "master_bedroom_mini_split_prev_hour": 'off' if states('sensor.snapshot_master_bedroom_mini_split_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_master_bedroom_mini_split_prev_hour'),
                 "master_bedroom_mini_split_now": 'off' if states('sensor.snapshot_master_bedroom_mini_split_now') in ['unknown', '0'] else states('sensor.snapshot_master_bedroom_mini_split_now'),
                 "master_bedroom_mini_split_changed": 1 if is_state('sensor.snapshot_master_bedroom_mini_split_changed', 'unknown') or is_state('sensor.snapshot_master_bedroom_mini_split_changed', '0') else  0,
                 "ducted_prev_hour": 'off' if states('sensor.snapshot_ducted_prev_hour') in ['unknown', '0'] else states('sensor.snapshot_ducted_prev_hour'),
                 "ducted_now": 'off' if states('sensor.snapshot_ducted_now') in ['unknown', '0'] else states('sensor.snapshot_ducted_now'),
                 "ducted_changed": 1 if is_state('sensor.snapshot_ducted_changed', 'unknown') or is_state('sensor.snapshot_ducted_changed', '0') else 0
              } | tojson
        }}