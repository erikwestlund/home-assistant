# 🟢 HVAC Preheat Start Required Master Bedroom
- name: "HVAC Preheat Start Required Master Bedroom"
  unique_id: hvac_preheat_start_required_master_bedroom
  state: >
    {% set now_time = now().timestamp() %}
    {% set daytime_start = as_timestamp(now().date() ~ ' ' ~ states('input_datetime.hvac_daytime_start_time_master_bedroom')) %}
    {% set preheat_end = as_timestamp(now().date() ~ ' ' ~ states('input_datetime.hvac_preheat_end_window_master_bedroom')) %}
    {% set estimated_target_time = as_timestamp(states('sensor.hvac_estimated_time_when_target_temperature_reached_starting_now_master_bedroom')) %}

    {% if now_time >= daytime_start and now_time <= preheat_end %}
      {{ estimated_target_time > preheat_end }}
    {% else %}
      false
    {% endif %}
  device_class: heat
  icon: mdi:clock-alert

# 🌡️ HVAC Preheating Active Master Bedroom
- name: "HVAC Preheating Active Master Bedroom"
  unique_id: hvac_preheating_active_master_bedroom
  state: >
    {% set preheat_required = is_state('binary_sensor.hvac_preheat_start_required_master_bedroom', 'on') %}
    {% set nighttime_active = is_state('binary_sensor.hvac_nighttime_active_master_bedroom', 'on') %}
    {% set override_status = is_state('input_boolean.hvac_override_status_master_bedroom', 'on') %}
    
    {{ preheat_required and nighttime_active and not override_status }}
  device_class: heat
  icon: >
    {% if is_state('binary_sensor.hvac_preheating_active_master_bedroom', 'on') %}
      mdi:fire
    {% else %}
      mdi:fire-off
    {% endif %}