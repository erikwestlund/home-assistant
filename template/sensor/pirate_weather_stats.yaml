- name: "Current Temperature"
  unique_id: current_temperature
  unit_of_measurement: "°F"
  state: >
    {{ state_attr('sensor.pirate_weather', 'currently')['temperature'] | round(2) if state_attr('sensor.pirate_weather', 'currently') else 'unavailable' }}

- name: "Daily High Temperature"
  unique_id: daily_high_temperature
  unit_of_measurement: "°F"
  state: >
    {% set daily = state_attr('sensor.pirate_weather', 'daily')['data'] %}
    {{ daily[0]['temperatureHigh'] if daily else 'unavailable' }}

- name: "Daily Low Temperature"
  unique_id: daily_low_temperature
  unit_of_measurement: "°F"
  state: >
    {% set daily = state_attr('sensor.pirate_weather', 'daily')['data'] %}
    {{ daily[0]['temperatureLow'] if daily else 'unavailable' }}

- name: "Daily Average Temperature"
  unique_id: daily_average_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set today_start = now().replace(hour=0, minute=0, second=0, microsecond=0).timestamp() %}
    {% set today_end = (now() + timedelta(days=1)).replace(hour=0, minute=0, second=0, microsecond=0).timestamp() %}
    {% set daily_temps = forecast | selectattr('time', '>=', today_start) | selectattr('time', '<=', today_end) | map(attribute='temperature') | list %}
    {{ (daily_temps | sum / daily_temps | length) | round(2) if daily_temps | length > 0 else 'unavailable' }}

- name: "Daytime High Temperature"
  unique_id: daytime_high_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set start_day = now().replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    {% set end_day = now().replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
    {% set daytime_temps = forecast | selectattr('time', '>=', start_day) | selectattr('time', '<=', end_day) | map(attribute='temperature') | list %}
    {{ daytime_temps | max if daytime_temps | length > 0 else 'unavailable' }}

- name: "Daytime Low Temperature"
  unique_id: daytime_low_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set start_day = now().replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    {% set end_day = now().replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
    {% set daytime_temps = forecast | selectattr('time', '>=', start_day) | selectattr('time', '<=', end_day) | map(attribute='temperature') | list %}
    {{ daytime_temps | min if daytime_temps | length > 0 else 'unavailable' }}

- name: "Daytime Average Temperature"
  unique_id: daytime_average_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set start_day = now().replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    {% set end_day = now().replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
    {% set daytime_temps = forecast | selectattr('time', '>=', start_day) | selectattr('time', '<=', end_day) | map(attribute='temperature') | list %}
    {{ (daytime_temps | sum / daytime_temps | length) | round(2) if daytime_temps | length > 0 else 'unavailable' }}

- name: "Nighttime High Temperature"
  unique_id: nighttime_high_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set start_night = now().replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
    {% set end_night = (now() + timedelta(days=1)).replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    {% set nighttime_temps = forecast | selectattr('time', '>=', start_night) | selectattr('time', '<=', end_night) | map(attribute='temperature') | list %}
    {{ nighttime_temps | max if nighttime_temps | length > 0 else 'unavailable' }}

- name: "Nighttime Low Temperature"
  unique_id: nighttime_low_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set start_night = now().replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
    {% set end_night = (now() + timedelta(days=1)).replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    {% set nighttime_temps = forecast | selectattr('time', '>=', start_night) | selectattr('time', '<=', end_night) | map(attribute='temperature') | list %}
    {{ nighttime_temps | min if nighttime_temps | length > 0 else 'unavailable' }}

- name: "Nighttime Average Temperature"
  unique_id: nighttime_average_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.pirate_weather', 'hourly')['data'] %}
    {% set start_night = now().replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
    {% set end_night = (now() + timedelta(days=1)).replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    {% set nighttime_temps = forecast | selectattr('time', '>=', start_night) | selectattr('time', '<=', end_night) | map(attribute='temperature') | list %}
    {{ (nighttime_temps | sum / nighttime_temps | length) | round(2) if nighttime_temps | length > 0 else 'unavailable' }}
