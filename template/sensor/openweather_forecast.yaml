- name: "Daytime Max Temperature"
  unique_id: daytime_max_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.openweather_hourly_forecast', 'hourly') %}
    {% set daytime_forecast = forecast | selectattr('dt', '>=', 1736341200) | selectattr('dt', '<=', 1736374800) | list %}
    {% set daytime_temps = daytime_forecast | map(attribute='temp') | list %}
    {{ daytime_temps | max if daytime_temps | length > 0 else 'unavailable' }}

- name: "Daytime Min Temperature"
  unique_id: daytime_min_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.openweather_hourly_forecast', 'hourly') %}
    {% set daytime_forecast = forecast | selectattr('dt', '>=', 1736341200) | selectattr('dt', '<=', 1736374800) | list %}
    {% set daytime_temps = daytime_forecast | map(attribute='temp') | list %}
    {{ daytime_temps | min if daytime_temps | length > 0 else 'unavailable' }}

- name: "Daytime Average Temperature"
  unique_id: daytime_average_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.openweather_hourly_forecast', 'hourly') %}
    {% set daytime_forecast = forecast | selectattr('dt', '>=', 1736341200) | selectattr('dt', '<=', 1736374800) | list %}
    {% set daytime_temps = daytime_forecast | map(attribute='temp') | list %}
    {{ (daytime_temps | sum / daytime_temps | length) | round(2) if daytime_temps | length > 0 else 'unavailable' }}

- name: "Nighttime Max Temperature"
  unique_id: nighttime_max_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.openweather_hourly_forecast', 'hourly') %}
    {% if forecast %}
      {% set now = now() %}
      {% set start_night = now.replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
      {% set end_night = (now + timedelta(days=1)).replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    
      {% set nighttime_forecast = forecast | selectattr('dt', '>=', start_night) | selectattr('dt', '<=', end_night) | list %}
      {% set nighttime_temps = nighttime_forecast | map(attribute='temp') | list %}
      {{ nighttime_temps | max if nighttime_temps | length > 0 else 'unavailable' }}
    {% else %}
      unavailable
    {% endif %}
    
- name: "Nighttime Min Temperature"
  unique_id: nighttime_min_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.openweather_hourly_forecast', 'hourly') %}
    {% if forecast %}
      {% set now = now() %}
      {% set start_night = now.replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
      {% set end_night = (now + timedelta(days=1)).replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    
      {% set nighttime_forecast = forecast | selectattr('dt', '>=', start_night) | selectattr('dt', '<=', end_night) | list %}
      {% set nighttime_temps = nighttime_forecast | map(attribute='temp') | list %}
      {{ nighttime_temps | min if nighttime_temps | length > 0 else 'unavailable' }}
    {% else %}
      unavailable
    {% endif %}

- name: "Nighttime Average Temperature"
  unique_id: nighttime_average_temperature
  unit_of_measurement: "°F"
  state: >
    {% set forecast = state_attr('sensor.openweather_hourly_forecast', 'hourly') %}
    {% if forecast %}
      {% set now = now() %}
      {% set start_night = now.replace(hour=19, minute=0, second=0, microsecond=0).timestamp() %}
      {% set end_night = (now + timedelta(days=1)).replace(hour=7, minute=0, second=0, microsecond=0).timestamp() %}
    
      {% set nighttime_forecast = forecast | selectattr('dt', '>=', start_night) | selectattr('dt', '<=', end_night) | list %}
      {% set nighttime_temps = nighttime_forecast | map(attribute='temp') | list %}
      {{ (nighttime_temps | sum / nighttime_temps | length) | round(2) if nighttime_temps | length > 0 else 'unavailable' }}
    {% else %}
      unavailable
    {% endif %}